2025-02-14 09:20:40,698 - INFO - === Logging Setup Complete ===
2025-02-14 09:20:43,683 - INFO - Loaded pbj_nurse with shape (1325324, 33)
2025-02-14 09:20:44,108 - INFO - Loaded pbj_non_nurse with shape (1325324, 82)
2025-02-14 09:20:44,429 - INFO - Loaded qrp_provider with shape (710016, 16)
2025-02-14 09:20:44,458 - INFO - Loaded nh_survey with shape (44189, 41)
2025-02-14 09:20:44,565 - INFO - Loaded nh_quality_mds with shape (251464, 23)
2025-02-14 09:20:44,648 - INFO - Loaded nh_ownership with shape (144651, 13)
2025-02-14 09:20:44,918 - INFO - Loaded nh_citations with shape (406789, 23)
2025-02-14 09:20:44,923 - INFO - === pbj_nurse DataFrame Info ===
2025-02-14 09:20:45,191 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 1325324 entries, 0 to 1325323
Data columns (total 33 columns):
 #   Column            Non-Null Count    Dtype         
---  ------            --------------    -----         
 0   provnum           1325324 non-null  object        
 1   provname          1325324 non-null  object        
 2   city              1325324 non-null  object        
 3   state             1325324 non-null  object        
 4   county_name       1325324 non-null  object        
 5   county_fips       1325324 non-null  int64         
 6   cy_qtr            1325324 non-null  object        
 7   workdate          1325324 non-null  datetime64[ns]
 8   mdscensus         1325324 non-null  int64         
 9   hrs_rndon         1325324 non-null  float64       
 10  hrs_rndon_emp     1325324 non-null  float64       
 11  hrs_rndon_ctr     1325324 non-null  float64       
 12  hrs_rnadmin       1325324 non-null  float64       
 13  hrs_rnadmin_emp   1325324 non-null  float64       
 14  hrs_rnadmin_ctr   1325324 non-null  float64       
 15  hrs_rn            1325324 non-null  float64       
 16  hrs_rn_emp        1325324 non-null  float64       
 17  hrs_rn_ctr        1325324 non-null  float64       
 18  hrs_lpnadmin      1325324 non-null  float64       
 19  hrs_lpnadmin_emp  1325324 non-null  float64       
 20  hrs_lpnadmin_ctr  1325324 non-null  float64       
 21  hrs_lpn           1325324 non-null  float64       
 22  hrs_lpn_emp       1325324 non-null  float64       
 23  hrs_lpn_ctr       1325324 non-null  float64       
 24  hrs_cna           1325324 non-null  float64       
 25  hrs_cna_emp       1325324 non-null  float64       
 26  hrs_cna_ctr       1325324 non-null  float64       
 27  hrs_natrn         1325324 non-null  float64       
 28  hrs_natrn_emp     1325324 non-null  float64       
 29  hrs_natrn_ctr     1325324 non-null  float64       
 30  hrs_medaide       1325324 non-null  float64       
 31  hrs_medaide_emp   1325324 non-null  float64       
 32  hrs_medaide_ctr   1325324 non-null  float64       
dtypes: datetime64[ns](1), float64(24), int64(2), object(6)
memory usage: 333.7+ MB
2025-02-14 09:20:45,191 - INFO - None
2025-02-14 09:20:45,191 - INFO - === Descriptive Statistics for pbj_nurse ===
2025-02-14 09:20:46,298 - INFO - county_fips                       workdate     mdscensus  \
count  1.325324e+06                        1325324  1.325324e+06   
mean   9.113430e+01  2024-05-15 23:59:59.999999744  8.341670e+01   
min    1.000000e+00            2024-04-01 00:00:00  0.000000e+00   
25%    3.100000e+01            2024-04-23 00:00:00  5.100000e+01   
50%    6.900000e+01            2024-05-16 00:00:00  7.600000e+01   
75%    1.170000e+02            2024-06-08 00:00:00  1.040000e+02   
max    8.400000e+02            2024-06-30 00:00:00  7.420000e+02   
std    9.912806e+01                            NaN  4.904109e+01   

          hrs_rndon  hrs_rndon_emp  hrs_rndon_ctr   hrs_rnadmin  \
count  1.325324e+06   1.325324e+06   1.325324e+06  1.325324e+06   
mean   5.195887e+00   5.099312e+00   9.657448e-02  1.026275e+01   
min    0.000000e+00   0.000000e+00   0.000000e+00  0.000000e+00   
25%    0.000000e+00   0.000000e+00   0.000000e+00  0.000000e+00   
50%    8.000000e+00   8.000000e+00   0.000000e+00  7.500000e+00   
75%    8.000000e+00   8.000000e+00   0.000000e+00  1.600000e+01   
max    1.039600e+02   1.039600e+02   2.575000e+01  2.755000e+02   
std    4.389664e+00   4.382255e+00   9.182349e-01  1.476875e+01   

       hrs_rnadmin_emp  hrs_rnadmin_ctr        hrs_rn  ...   hrs_lpn_ctr  \
count     1.325324e+06     1.325324e+06  1.325324e+06  ...  1.325324e+06   
mean      1.001164e+01     2.511122e-01  3.480192e+01  ...  6.133439e+00   
min       0.000000e+00     0.000000e+00  0.000000e+00  ...  0.000000e+00   
25%       0.000000e+00     0.000000e+00  1.325000e+01  ...  0.000000e+00   
50%       7.500000e+00     0.000000e+00  2.575000e+01  ...  0.000000e+00   
75%       1.600000e+01     0.000000e+00  4.525000e+01  ...  4.000000e+00   
max       2.755000e+02     8.725000e+01  9.159800e+02  ...  1.380150e+04   
std       1.455953e+01     1.845270e+00  3.532269e+01  ...  1.963754e+01   

            hrs_cna   hrs_cna_emp   hrs_cna_ctr     hrs_natrn  hrs_natrn_emp  \
count  1.325324e+06  1.325324e+06  1.325324e+06  1.325324e+06   1.325324e+06   
mean   1.737908e+02  1.616093e+02  1.218150e+01  4.314155e+00   4.262067e+00   
min    0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00   0.000000e+00   
25%    9.857000e+01  9.025000e+01  0.000000e+00  0.000000e+00   0.000000e+00   
50%    1.506200e+02  1.400000e+02  0.000000e+00  0.000000e+00   0.000000e+00   
75%    2.200000e+02  2.074800e+02  8.000000e+00  0.000000e+00   0.000000e+00   
max    1.758100e+03  1.503630e+03  6.614200e+02  4.437500e+02   4.387500e+02   
std    1.151591e+02  1.081243e+02  3.184142e+01  1.336067e+01   1.302080e+01   

       hrs_natrn_ctr   hrs_medaide  hrs_medaide_emp  hrs_medaide_ctr  
count   1.325324e+06  1.325324e+06     1.325324e+06     1.325324e+06  
mean    5.208815e-02  8.578327e+00     8.363303e+00     2.150232e-01  
min     0.000000e+00  0.000000e+00     0.000000e+00     0.000000e+00  
25%     0.000000e+00  0.000000e+00     0.000000e+00     0.000000e+00  
50%     0.000000e+00  0.000000e+00     0.000000e+00     0.000000e+00  
75%     0.000000e+00  1.131000e+01     1.087000e+01     0.000000e+00  
max     2.470000e+02  4.298000e+02     4.298000e+02     8.775000e+01  
std     2.011555e+00  1.785970e+01     1.749784e+01     2.104964e+00  

[8 rows x 27 columns]
2025-02-14 09:20:46,298 - INFO - === Missing Values in pbj_nurse ===
2025-02-14 09:20:46,540 - INFO - provnum             0
provname            0
city                0
state               0
county_name         0
county_fips         0
cy_qtr              0
workdate            0
mdscensus           0
hrs_rndon           0
hrs_rndon_emp       0
hrs_rndon_ctr       0
hrs_rnadmin         0
hrs_rnadmin_emp     0
hrs_rnadmin_ctr     0
hrs_rn              0
hrs_rn_emp          0
hrs_rn_ctr          0
hrs_lpnadmin        0
hrs_lpnadmin_emp    0
hrs_lpnadmin_ctr    0
hrs_lpn             0
hrs_lpn_emp         0
hrs_lpn_ctr         0
hrs_cna             0
hrs_cna_emp         0
hrs_cna_ctr         0
hrs_natrn           0
hrs_natrn_emp       0
hrs_natrn_ctr       0
hrs_medaide         0
hrs_medaide_emp     0
hrs_medaide_ctr     0
dtype: int64
2025-02-14 09:20:46,547 - INFO - 'workdate' is already in datetime format.
2025-02-14 09:20:46,877 - INFO - === Daily Aggregated RN Staffing ===
2025-02-14 09:20:46,878 - INFO - date  hrs_rn_emp  hrs_rn_ctr  rn_temp_ratio
0  2024-04-01   470443.15    41281.17       0.080671
1  2024-04-02   489100.43    40355.02       0.076220
2  2024-04-03   490437.21    41284.52       0.077643
3  2024-04-04   487985.68    41300.77       0.078031
4  2024-04-05   472199.99    43778.98       0.084846
2025-02-14 09:20:52,109 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:20:52,114 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:01,877 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:01,881 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:02,298 - INFO - Correlation between RN Temp Ratio and Average Daily Census: -0.3010
2025-02-14 09:21:03,381 - INFO - Shift-level data not available in pbj_nurse. Skipping shift-level analysis.
2025-02-14 09:21:04,170 - INFO - Correlation between RN Temp Ratio and QRP Score: -0.0071
2025-02-14 09:21:04,575 - INFO - Number of records with near-100% RN contract usage:
2025-02-14 09:21:04,575 - INFO - 23837
2025-02-14 09:21:04,577 - INFO - Unique facilities with exclusive contract days:
2025-02-14 09:21:04,577 - INFO - 2246
2025-02-14 09:21:04,720 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:04,724 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:13,028 - INFO - Columns in pbj_nurse_copy:
2025-02-14 09:21:13,028 - INFO - ['workdate', 'provnum', 'provname', 'city', 'state', 'county_name', 'county_fips', 'cy_qtr', 'mdscensus', 'hrs_rndon', 'hrs_rndon_emp', 'hrs_rndon_ctr', 'hrs_rnadmin', 'hrs_rnadmin_emp', 'hrs_rnadmin_ctr', 'hrs_rn', 'hrs_rn_emp', 'hrs_rn_ctr', 'hrs_lpnadmin', 'hrs_lpnadmin_emp', 'hrs_lpnadmin_ctr', 'hrs_lpn', 'hrs_lpn_emp', 'hrs_lpn_ctr', 'hrs_cna', 'hrs_cna_emp', 'hrs_cna_ctr', 'hrs_natrn', 'hrs_natrn_emp', 'hrs_natrn_ctr', 'hrs_medaide', 'hrs_medaide_emp', 'hrs_medaide_ctr', 'date']
2025-02-14 09:21:13,139 - INFO - Columns in daily_cna:
2025-02-14 09:21:13,140 - INFO - ['date', 'hrs_cna_emp', 'hrs_cna_ctr', 'mdscensus']
2025-02-14 09:21:13,141 - INFO - CNA Ratio vs. Census correlation: -0.4046
2025-02-14 09:21:13,285 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:13,288 - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-02-14 09:21:13,549 - INFO - Days with high RN ratio variability:
2025-02-14 09:21:13,550 - INFO - date  rn_temp_ratio  rn_ratio_rolling_std
42 2024-05-13       0.079371              0.008441
46 2024-05-17       0.085538              0.008471
78 2024-06-18       0.071336              0.008514
79 2024-06-19       0.073229              0.008464
2025-02-14 09:21:21,341 - ERROR - C:\Users\paulo\AppData\Local\Temp\ipykernel_12112\2212379707.py:54: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  facility_var = facility_var.groupby('provnum', group_keys=False).apply(rolling_std_by_facility)
2025-02-14 09:21:21,382 - INFO - Facility-level days with high variability in RN ratio:
2025-02-14 09:21:21,386 - INFO - provnum       date  rn_temp_ratio  rn_ratio_rolling_std
1566  015044 2024-04-20       0.653259              0.246909
1567  015044 2024-04-21       1.000000              0.415588
1568  015044 2024-04-22       0.000000              0.415588
1569  015044 2024-04-23       0.000000              0.415588
1570  015044 2024-04-24       0.000000              0.415588
1571  015044 2024-04-25       0.000000              0.415588
1572  015044 2024-04-26       0.000000              0.415588
1573  015044 2024-04-27       0.611973              0.408922
1574  015044 2024-04-28       0.592776              0.293981
1575  015044 2024-04-29       0.000000              0.293981
2025-02-14 09:21:23,508 - INFO - Cluster means:
2025-02-14 09:21:23,510 - INFO - rn_temp_ratio   mdscensus
cluster                           
0             0.071620   51.199012
1             0.069035  106.590687
2             0.115694  219.788822
2025-02-14 09:21:23,538 - INFO - Correlation between RN Temp Ratio and Total Health Deficiencies: 0.0954
2025-02-14 09:21:23,771 - INFO - Top 10% Facilities by Total RN Hours:
2025-02-14 09:21:23,776 - INFO - total_rn_hours  rn_temp_ratio    mdscensus
count     1457.000000    1457.000000  1457.000000
mean      9664.363940       0.095460   150.175168
std       5130.626225       0.166342    81.354314
min       6096.720000       0.000000    13.098901
25%       6857.940000       0.000000   100.065934
50%       7997.620000       0.002374   134.142857
75%      10278.460000       0.127054   178.461538
max      72428.520000       1.000000   732.263736
2025-02-14 09:21:24,198 - INFO - Summary statistics for daily RN temp ratio differences:
2025-02-14 09:21:24,199 - INFO - count    90.000000
mean      0.000061
std       0.006486
min      -0.014423
25%      -0.004828
50%       0.000663
75%       0.005298
max       0.011160
Name: rn_ratio_diff, dtype: float64
2025-02-14 09:21:24,239 - INFO - Correlation between RN Temp Ratio and Four-Quarter Average Quality Score: -0.0717
